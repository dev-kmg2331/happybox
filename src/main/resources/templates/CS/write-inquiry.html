<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" href="/img/main/fabicon.png" type="image/png" sizes="50x50"/>
    <link rel="stylesheet" href="/css/global/global.css" />
    <link rel="stylesheet" href="/css/CS/common.css" />
    <link rel="stylesheet" href="/css/CS/write-inquiry.css" />
    <link rel="stylesheet" href="/css/component/header.css"/>
    <link rel="stylesheet" href="/css/component/footer.css"/>
    <title>1:1 문의</title>
</head>
<body>
<header class="header-stage" th:insert="~{component/header.html :: header}"></header>
<section class="container">
    <div class="content-wrap frame-sm">
        <div class="page-title-area">
            <h2 class="title-page">
                <a href="javascript:void(0)">고객센터</a>
            </h2>
        </div>
        <div class="frame-wrap">
            <!-- 사이드바는 타임리프 fragment로 묶을것. 임시로 list.js에 load() 사용 -->
            <div th:insert="~{CS/sidebar :: sidebar}"></div>
            <div class="frame-right">
                <div class="frame-cnt-inner">
                    <div class="form-wrap">
                        <div class="menu-title-area">
                            <h3 class="title-menu">1:1 문의하기</h3>
                        </div>
                    </div>
                    <div class="board-form">
                        <!-- DTO를 넘겨주기 위한 폼 -->
                        <form th:action="@{/cs/write}" name="write" method="post" th:object="${inquiryDTO}">
                            <table class="table">
                                <tr>
                                    <th class="text-left">
                                        <div class="in-tb">
                                            문의 유형
                                            <em class="es"></em>
                                        </div>
                                    </th>
                                    <td class="text-left">
                                        <div class="input-group w-full">
                                            <div class="input-group-form">
                                                <div
                                                        class="ui-select select-box w150"
                                                        id="vCounselType"
                                                        data-value=""
                                                >
                                                    <a
                                                            href="javascript:void(0)"
                                                            class="select-value placeholder"
                                                    ><span id="value">유형선택</span></a
                                                    >
                                                    <div class="select-list disNone">
                                                        <ul></ul>
                                                    </div>
                                                </div>
                                            </div>
                                            <input
                                                    type="text"
                                                    name="inquiryTitle"
                                                    class="input-text h40"
                                                    placeholder="제목을 입력해주세요"
                                                    value=""
                                                    th:field="*{inquiryTitle}"
                                            />
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <th class="text-left">
                                        <div class="in-tb">복지관 선택</div>
                                    </th>
                                    <td class="text-left">
                                        <div class="input-group w-full">
                                            <input
                                                    type="text"
                                                    name="welfare-selection"
                                                    class="input-text h40"
                                                    placeholder="복지관명 (선택사항)"
                                                    value=""
                                                    readonly="true"
                                            />
                                            <span class="input-group-btn">
                                                <button
                                                        type="button"
                                                        id="btn_orderProduct"
                                                        class="btn-form btn-ex-white w150 welfareSearchBtn"
                                                >
                                                    <span>복지관 검색</span>
                                                </button>
                                            </span>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <th class="text-left">
                                        <div class="in-tb">
                                            문의 내용
                                            <em class="es"></em>
                                        </div>
                                    </th>
                                    <td class="text-left">
                                        <div class="textarea-box-count h230">
                                                    <textarea
                                                            id="vQuestionCont"
                                                            placeholder="문의내용을 입력하세요"
                                                            name="inquiryContent"
                                                            th:field="*{inquiryContent}"
                                                    ></textarea>
                                            <div class="txt-count">
                                                <span id="counter">0</span> /
                                                <span class="total"></span>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                <tr class="attach-file-line">
                                    <th class="text-left"></th>
                                    <td class="text-left file-box-wrap">
                                        <div class="file-add-boxes">
                                            <div class="div-attach-thumb">
                                                <label>
                                                    <button class="btn-attach-thumb" type="button">
                                                        <i class="ico-plus-xlg">
                                                            <svg
                                                                    height="26px"
                                                                    viewBox="0 0 512 512"
                                                                    width="26px"
                                                            >
                                                                <g>
                                                                    <path
                                                                            d="M384,265H264v119h-17V265H128v-17h119V128h17v120h120V265z"
                                                                    />
                                                                </g>
                                                            </svg>
                                                        </i>
                                                    </button>
                                                    <input
                                                            type="file"
                                                            name="imgFile"
                                                            style="display: none"
                                                            accept="image/*"
                                                    />
                                                </label>
                                                <span class="x-image">x</span>
                                            </div>
                                        </div>
                                        <div class="file-add-boxes">
                                            <div class="div-attach-thumb">
                                                <label>
                                                    <button class="btn-attach-thumb" type="button">
                                                        <i class="ico-plus-xlg">
                                                            <svg
                                                                    height="26px"
                                                                    viewBox="0 0 512 512"
                                                                    width="26px"
                                                            >
                                                                <g>
                                                                    <path
                                                                            d="M384,265H264v119h-17V265H128v-17h119V128h17v120h120V265z"
                                                                    />
                                                                </g>
                                                            </svg>
                                                        </i>
                                                    </button>
                                                    <input
                                                            type="file"
                                                            name="imgFile"
                                                            style="display: none"
                                                            accept="image/*"
                                                    />
                                                </label>
                                                <span class="x-image">x</span>
                                            </div>
                                        </div>
                                        <div class="file-add-boxes">
                                            <div class="div-attach-thumb">
                                                <label>
                                                    <button class="btn-attach-thumb" type="button">
                                                        <i class="ico-plus-xlg">
                                                            <svg
                                                                    height="26px"
                                                                    viewBox="0 0 512 512"
                                                                    width="26px"
                                                            >
                                                                <g>
                                                                    <path
                                                                            d="M384,265H264v119h-17V265H128v-17h119V128h17v120h120V265z"
                                                                    />
                                                                </g>
                                                            </svg>
                                                        </i>
                                                    </button>
                                                    <input
                                                            type="file"
                                                            name="imgFile"
                                                            style="display: none"
                                                            accept="image/*"
                                                    />
                                                </label>
                                                <span class="x-image">x</span>
                                            </div>
                                        </div>
                                        <p class="text-guide-md">
                                            - 최대 15MB 이하의 JPG, PNG, GIF, BMP 파일 3장까지
                                            첨부 가능합니다.
                                        </p>
                                    </td>
                                </tr>
                            </table>
                        </form>
                        <div class="btn-bottom-area">
                            <button
                                    type="button"
                                    class="btn-basic-lg2 btn-grey3"
                            >
                                <span>취소하기</span>
                            </button>
                            <button
                                    type="button"
                                    class="btn-basic-lg2 btn-primary"
                            >
                                <span>문의하기</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<section class="search-modal-wrap disNone">
    <div class="layer-pop order-search-pop">
        <div class="layer-inner">
            <div class="layer-head">
                <h4 class="layer-pop-title">복지관 검색</h4>
            </div>
            <div class="layer-content">
                <!-- 검색바 -->
                <div class="search-box ui-toggle on">
                    <div class="input-group w-full">
                        <input
                                type="text"
                                name="welfare-selection"
                                class="input-text h40"
                                placeholder="선택한 복지관"
                                value=""
                                readonly
                        />
                        <span class="input-group-btn">
                                    <button type="button" class="btn-form btn-ex-white w150 find-btn">
                                        <span>복지관 검색</span>
                                    </button>
                                </span>
                    </div>
                </div>
                <div id="productPop">
                    <div class="board-list">
                        <table class="API-table">
                            <thead class="thead"></thead>
                            <tbody class="tbody"></tbody>
                        </table>
                        <ul class="select-form-list">
                            <!-- 데이터 없으면 disNone으로 -->
                            <li>
                                <div class="no-data">
                                    <p class="find-message">내역이 없습니다.</p>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="btn-area">
                <button type="button" class="btn-basic-md btn-grey3 modalClose">
                    <span>취소</span>
                </button>
                <button type="button" class="btn-basic-md btn-black welfareSelect">
                    <span>선택</span>
                </button>
            </div>
            <!--// layer-content -->
            <button type="button" class="btn-x-md2 ui-close-pop modalClose" title="닫기">
                <i class="ico-x-black">
                    <svg
                            xmlns="http://www.w3.org/2000/svg"
                            xmlns:xlink="http://www.w3.org/1999/xlink"
                            id="Layer_1"
                            style="enable-background: new 0 0 64 64"
                            version="1.1"
                            viewBox="0 0 64 64"
                            xml:space="preserve"
                    >
                        <style type="text/css">
                            .st0 {
                                fill: #333;
                            }
                        </style>
                        <g>
                            <g
                                    id="Icon-Close"
                                    transform="translate(381.000000, 231.000000)"
                            >
                            <polyline
                                    class="st0"
                                    id="Fill-16"
                                    points="-370.7,-174.7 -373,-177 -327,-223 -324.7,-220.7 -370.7,-174.7    "
                            />
                                <polyline
                                        class="st0"
                                        id="Fill-17"
                                        points="-327,-174.7 -373,-220.7 -370.7,-223 -324.7,-177 -327,-174.7    "
                                />
                            </g>
                        </g>
                    </svg>
                </i>
            </button>
        </div>
    </div>
</section>
<footer class="footer-stage" th:insert="~{component/footer.html :: footer}"></footer>
</body>
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<!-- 임시 사이드바 js 이후 th fragment로 대체 -->
<script src="/js/admin/event.js"></script>
<script src="/js/CS/inquiry-write.js"></script>
<script src="/js/main/header.js"></script>
<script>
    $('.find-btn').on('click', function () {
        let queryParams = '집'

        let url = `http://openapi.seoul.go.kr:8088/63455a5a69646576313363576d774c/json/GbFreeMealOrgan/1/10/${queryParams}`;
        let getUrl = `http://openapi.seoul.go.kr:8088/63455a5a69646576313363576d774c/json/fcltOpenInfo/1/80/`;

        $.ajax({
            url: getUrl,
            type: "GET",
            dataType: 'json',
            success: function(data) {
                /* 새로 요청할 때마다 기존에 있는 내역 지워주기 */
                $('.tbody').empty();
                console.log(data);
                let jsonData = data.fcltOpenInfo.row;
                let table = $('.API-table').addClass('data-table');
                /* 헤더 생성 */
                let headerRow = $('<tr>');

                headerRow.append($('<th>').text('시설명'));
                headerRow.append($('<th>').text('시설주소'));
                headerRow.append($('<th>').text('전화번호'));
                headerRow.append($('<th>').text('우편번호'));

                // ... 필요한 만큼 필드 추가
                $('.thead').html(headerRow);

                // 테이블 내용 생성
                jsonData.forEach(function(rowData) {
                    let row = $('<tr class="API-data">');
                    row.append($('<td>').text(rowData.FCLT_NM));
                    row.append($('<td>').text(rowData.FCLT_ADDR));
                    row.append($('<td style="text-align: center">').text(rowData.FCLT_TEL_NO));
                    row.append($('<td style="text-align: center">').text(rowData.FCLT_ZIPCD));

                    // ... 필요한 만큼 필드 추가
                    $('.tbody').append(row);
                });
                /* 각 행을 누르기 위한 작업 */
                const $dataRows = $('.tbody .API-data');

                /* 각 행을 누르면 해당 행의 시설명을 가지고 가기 */
                $dataRows.each((i, v) => {
                    $(v).on('click', function () {
                        let value = $(this).children().first().text();
                        $("input[name=welfare-selection]").val(value)
                    })
                })
            },
            error: function(error) {
                console.error(error);
            }
        });
        $('.select-form-list').hide();
    })
</script>
</html>
